class environment;
  generator gen;
  driver drv;
  monitor mon;
  scoreboard sco;
  event next;
  
  mailbox #(transaction) gtsmbx;
  mailbox #(transaction) gtdmbx;
  mailbox #(transaction) mtsmbx;
  
  virtual dff_if vif;
  
  function new(virtual dff_if vif);
               gtsmbx=new();
               gtdmbx=new();
               mtsmbx=new();
               gen=new(gtdmbx,gtsmbx);
               drv=new(gtdmbx);
               mon=new(mtsmbx);
               sco=new(mtsmbx,gtsmbx);
               this.vif=vif;
               drv.vif=this.vif;
               mon.vif=this.vif;
               gen.sconext=next;
               sco.sconext=next;
   endfunction
               
   task pre_test();
     drv.reset();
   endtask
   
               task test();
                 fork
                   gen.run();
                   drv.run();
                   mon.run();
                   sco.run();
                 join_any
               endtask
               
               task post_test();
                 wait(gen.done.triggered)
                 $finish();
               endtask
               
               task run();
                 pre_test();
                 test();
                 post_test();
               endtask
  endclass
               
